<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevTrader Pro Terminal</title>
    
    <link rel="icon" href="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3e%3crect width='100' height='100' rx='20' fill='%230f172a'/%3e%3cpath d='M30 70 L50 40 L70 70' fill='none' stroke='%233b82f6' stroke-width='8'/%3e%3c/svg%3e">

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Professional Overrides */
        :root {
            --bg-app: #0f172a; /* Slate 900 */
            --bg-panel: #1e293b; /* Slate 800 */
            --border-color: #334155; /* Slate 700 */
            --primary: #3b82f6; /* Blue 500 */
            --success: #10b981; /* Emerald 500 */
            --danger: #f43f5e; /* Rose 500 */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-app);
            color: #e2e8f0;
            overscroll-behavior-y: none;
        }

        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-app); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Utilities */
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        .fab-shadow { box-shadow: 0 4px 14px 0 rgba(59, 130, 246, 0.39); }
        
        /* Animations */
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.4s ease-out forwards; }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: { 850: '#172033', 900: '#0f172a' },
                        blue: { 550: '#3b82f6' }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-slate-900 dark:text-slate-100 transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo, useRef } = React;

        // --- FIREBASE CONFIGURATION (PLACEHOLDER - REPLACE WITH YOURS) ---
        const firebaseConfig = {
            apiKey: "AIzaSyDi8RF59y1nwso78Zi3Wu8uxjc00yPRSQY",
            authDomain: "dev-trader-ac3ce.firebaseapp.com",
            databaseURL: "https://dev-trader-ac3ce-default-rtdb.firebaseio.com",
            projectId: "dev-trader-ac3ce",
            storageBucket: "dev-trader-ac3ce.firebasestorage.app",
            messagingSenderId: "61667328586",
            appId: "1:61667328586:web:4a3ae80c7012335c461cb3",
            measurementId: "G-LZHWCYY6ZG"
        };

        // Initialize Firebase
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
        } catch (e) { console.error("Firebase Init Error", e); }
        
        const auth = firebase.auth();
        const db = firebase.database();

        // --- APP CONSTANTS ---
        const GEMINI_API_KEY = "AIzaSyCL1goQPGdTFp_IizpTteU9ZTvcTQG3kzM"; 
        const DEFAULT_INITIAL_CAPITAL = 50000;
        const DEFAULT_FINAL_TARGET = 1000000;
        const DEFAULT_TENURE_DAYS = 66; 
        const TRADING_DAYS_PER_MONTH = 22;
        const DAYS_PER_PAGE = 10; 
        
        const DEFAULT_RULES = [ 
            { text: "Adhere to Trading Plan", checked: false }, 
            { text: "Confirm Entry/Exit Criteria", checked: false }, 
            { text: "Check Macro Trends", checked: false }, 
            { text: "Max Risk 2% Per Trade", checked: false }, 
            { text: "Stop-Loss Non-Negotiable", checked: false }, 
            { text: "Daily Drawdown Limit Set", checked: false }, 
            { text: "No Emotional Execution", checked: false }, 
            { text: "Maintain Objective Logic", checked: false }, 
            { text: "Log Trade Immediately", checked: false }, 
            { text: "Mental State Check: Peak", checked: false }, 
        ];

        // --- UTILS ---
        const getNextTradingDay = (date) => { const nextDay = new Date(date); nextDay.setDate(nextDay.getDate() + 1); while (nextDay.getDay() === 0 || nextDay.getDay() === 6) { nextDay.setDate(nextDay.getDate() + 1); } return nextDay; };
        const getTodayDateString = () => new Date().toISOString().split('T')[0];
        const getCurrentFormattedDate = () => new Date().toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        
        const formatCurrency = (num) => {
            const number = Number(num);
            if (isNaN(number)) return '₹0';
            return '₹' + number.toLocaleString('en-IN', { maximumFractionDigits: 0 });
        };

        const formatPercent = (num) => {
            return (num * 100).toFixed(2) + '%';
        };

        // --- ICONS ---
        const Icons = {
            Chart: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>,
            Bubble: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20 12a8 8 0 11-16 0 8 8 0 0116 0zM12 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>,
            Sun: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>,
            Moon: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>,
            User: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>,
            AI: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>,
            ArrowUp: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>,
            Calendar: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
        };

        // --- COMPONENTS ---

        const ProClock = ({ title, timezoneOffset = 0, theme }) => {
            const [time, setTime] = useState(new Date());
            useEffect(() => {
                const timer = setInterval(() => {
                    const d = new Date();
                    // Simple offset adjustment (not perfect for all TZ but visually functional)
                    // Using local time for simplicity in this demo unless offset logic added
                    setTime(d); 
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            const seconds = time.getSeconds();
            const minutes = time.getMinutes();
            const hours = time.getHours();
            
            const secondDeg = (seconds / 60) * 360;
            const minuteDeg = (minutes / 60) * 360 + (seconds / 60) * 6;
            const hourDeg = (hours / 12) * 360 + (minutes / 60) * 30;

            const isDark = theme === 'dark';
            const colorTick = isDark ? '#475569' : '#cbd5e1';
            const colorHandMain = isDark ? '#e2e8f0' : '#1e293b';
            const colorAccent = isDark ? '#3b82f6' : '#2563eb'; // Blue accent

            return (
                <div className="flex flex-col items-center">
                    <div className="relative w-24 h-24 bg-white dark:bg-slate-800 rounded-full border-4 border-slate-200 dark:border-slate-700 shadow-sm">
                        <svg viewBox="0 0 100 100" className="w-full h-full">
                            {/* Dial Markers */}
                            {Array.from({ length: 12 }).map((_, i) => (
                                <line key={i} x1="50" y1="10" x2="50" y2={i % 3 === 0 ? "18" : "14"} 
                                      stroke={colorTick} strokeWidth={i % 3 === 0 ? "3" : "1"} 
                                      transform={`rotate(${i * 30} 50 50)`} />
                            ))}
                             {/* Minute Markers (Small) */}
                             {Array.from({ length: 60 }).map((_, i) => (
                                <line key={`m${i}`} x1="50" y1="10" x2="50" y2="12" 
                                      stroke={colorTick} strokeWidth="0.5" 
                                      transform={`rotate(${i * 6} 50 50)`} />
                            ))}

                            {/* Hands */}
                            <line x1="50" y1="50" x2="50" y2="30" stroke={colorHandMain} strokeWidth="3" strokeLinecap="round" transform={`rotate(${hourDeg} 50 50)`} />
                            <line x1="50" y1="50" x2="50" y2="20" stroke={colorHandMain} strokeWidth="2" strokeLinecap="round" transform={`rotate(${minuteDeg} 50 50)`} />
                            <line x1="50" y1="50" x2="50" y2="15" stroke={colorAccent} strokeWidth="1" transform={`rotate(${secondDeg} 50 50)`} />
                            <circle cx="50" cy="50" r="3" fill={colorAccent} />
                        </svg>
                    </div>
                    <span className="text-[10px] uppercase tracking-wider mt-1 font-bold text-slate-500">{title}</span>
                </div>
            );
        };

        const Sidebar = ({ active, setActive }) => {
            const menuItems = [
                { id: 'journal', icon: <Icons.Chart />, label: 'Journal' },
                { id: 'analytics', icon: <Icons.Bubble />, label: 'Analytics' }, // Placeholder
                { id: 'calendar', icon: <Icons.Calendar />, label: 'Calendar' }, // Placeholder
            ];

            return (
                <aside className="hidden md:flex flex-col w-20 h-screen fixed left-0 top-0 bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 z-50 items-center py-6">
                    <div className="mb-8 text-blue-600 dark:text-blue-500 font-black text-2xl tracking-tighter">DT</div>
                    <nav className="flex flex-col gap-4 w-full px-2">
                        {menuItems.map(item => (
                            <button 
                                key={item.id}
                                onClick={() => setActive(item.id)}
                                className={`p-3 rounded-xl flex flex-col items-center gap-1 transition-all ${active === item.id ? 'bg-blue-50 dark:bg-slate-800 text-blue-600 dark:text-blue-400' : 'text-slate-400 hover:text-slate-600 dark:hover:text-slate-200'}`}
                            >
                                {item.icon}
                                <span className="text-[10px] font-medium">{item.label}</span>
                            </button>
                        ))}
                    </nav>
                </aside>
            );
        };

        const StatBox = ({ label, value, subtext, isCurrency = false }) => (
            <div className="bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm flex flex-col">
                <span className="text-xs text-slate-500 uppercase font-semibold tracking-wide mb-1">{label}</span>
                <span className="text-2xl font-bold text-slate-900 dark:text-white font-mono tracking-tight">{value}</span>
                {subtext && <span className="text-xs text-emerald-500 font-medium mt-1">{subtext}</span>}
            </div>
        );

        // --- GEMINI AI PANEL (MODAL) ---
        const AnalystPanel = ({ onClose, tradingData }) => {
            const [prompt, setPrompt] = useState("Analyze my recent trading performance based on the provided data. Give me 3 actionable insights."); 
            const [isLoading, setIsLoading] = useState(false);
            const [response, setResponse] = useState("");

            const callGeminiAPI = async (userPrompt, data) => {
                const key = GEMINI_API_KEY;
                setIsLoading(true); setResponse(""); 
                try {
                    const apiEndpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${key}`;
                    const dataSummary = data.map(d => ({ 
                        day: d.day, date: d.date, 
                        pnl: (d.pnlSign === '+' ? 1 : -1) * (Number(d.actual) || 0), 
                        wins: d.winningTrades, losses: d.losingTrades 
                    })).filter(d => d.pnl !== 0 || d.wins || d.losses);
                    
                    const requestBody = { contents: [{ parts: [{ text: `${userPrompt}\n\nTrading Data:\n${JSON.stringify(dataSummary, null, 2)}` }] }] };
                    const res = await fetch(apiEndpoint, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(requestBody) });
                    
                    if (!res.ok) throw new Error(`API Error ${res.status}`);
                    const resJson = await res.json();
                    const text = resJson?.candidates?.[0]?.content?.parts?.[0]?.text || "No response.";
                    setResponse(text);
                } catch (error) { setResponse(`Error: ${error.message}`); } 
                finally { setIsLoading(false); }
            };

            return (
                <div className="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex justify-end">
                    <div className="w-full max-w-md bg-white dark:bg-slate-900 h-full shadow-2xl border-l border-slate-200 dark:border-slate-700 flex flex-col animate-fade-in">
                        <div className="p-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-800">
                            <div className="flex items-center gap-2">
                                <div className="p-2 bg-blue-100 dark:bg-blue-900 rounded-lg text-blue-600 dark:text-blue-400"><Icons.AI /></div>
                                <h3 className="font-bold text-slate-800 dark:text-white">Trading Analyst</h3>
                            </div>
                            <button onClick={onClose} className="text-slate-400 hover:text-slate-600">✕</button>
                        </div>
                        <div className="p-4 flex-grow overflow-y-auto bg-slate-50 dark:bg-slate-950 font-mono text-sm">
                            {response ? (
                                <div className="prose dark:prose-invert max-w-none whitespace-pre-wrap">{response}</div>
                            ) : (
                                <div className="text-slate-400 text-center mt-10">Ready to analyze your performance.</div>
                            )}
                            {isLoading && <div className="mt-4 text-blue-500 animate-pulse">Analyzing market data...</div>}
                        </div>
                        <div className="p-4 border-t border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900">
                            <textarea 
                                className="w-full bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none mb-3 resize-none"
                                rows="3"
                                value={prompt}
                                onChange={e => setPrompt(e.target.value)}
                            ></textarea>
                            <button 
                                onClick={() => callGeminiAPI(prompt, tradingData)}
                                disabled={isLoading}
                                className="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 rounded-lg transition-colors disabled:opacity-50 flex justify-center items-center gap-2"
                            >
                                <Icons.AI /> Generate Insights
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        function App({ user, onLogout }) {
            const [data, setData] = useState(null);
            const [activeMonthIndex, setActiveMonthIndex] = useState(0);
            const [theme, setTheme] = useState(() => localStorage.getItem("theme") || "dark");
            const [currentTime, setCurrentTime] = useState(new Date().toLocaleTimeString());
            const [currentPage, setCurrentPage] = useState(1);
            const [isAnalystOpen, setAnalystOpen] = useState(false);
            
            // Config State
            const [inputCapital, setInputCapital] = useState(DEFAULT_INITIAL_CAPITAL);
            const [inputTarget, setInputTarget] = useState(DEFAULT_FINAL_TARGET);
            const [inputTenure, setInputTenure] = useState(DEFAULT_TENURE_DAYS);

            const scrollRef = useRef(null);

            useEffect(() => { 
                const t = setInterval(() => setCurrentTime(new Date().toLocaleTimeString()), 1000); 
                return () => clearInterval(t); 
            }, []);

            useEffect(() => {
                document.documentElement.classList.toggle("dark", theme === "dark");
                localStorage.setItem("theme", theme);
            }, [theme]);

            const toggleTheme = () => setTheme(prev => prev === 'dark' ? 'light' : 'dark');

            // Data Logic (Similar to before, simplified for brevity)
            const generatePlan = useCallback((tenure) => {
                 let months = []; let date = new Date(); let count = 0;
                 while(count < tenure) {
                     const mIdx = Math.floor(count / TRADING_DAYS_PER_MONTH);
                     if(!months[mIdx]) months[mIdx] = { id: mIdx + 1, monthName: date.toLocaleString('default', {month:'long', year:'numeric'}), days: [] };
                     const dateStr = date.toISOString().split('T')[0];
                     months[mIdx].days.push({ 
                         day: count + 1, date: dateStr, capital: 0, target: 0, profit: 0, dailyRate: 0, achieved: false, 
                         pnlSign: "+", actual: "", winningTrades: "", losingTrades: "", logic: "", rules: JSON.parse(JSON.stringify(DEFAULT_RULES)) 
                     });
                     date = getNextTradingDay(date); count++;
                 }
                 return months;
            }, []);

            const recalculate = useCallback((fullData) => {
                const { initialCapital, finalTarget, tenure } = fullData;
                const newMonths = JSON.parse(JSON.stringify(fullData.months));
                const allDays = newMonths.flatMap(m => m.days);
                let cap = Number(initialCapital);
                let daysLeft = Number(tenure);

                allDays.forEach(day => {
                    day.capital = Math.round(cap);
                    let rate = 0;
                    if(cap > 0 && daysLeft > 0 && finalTarget > cap) rate = Math.pow(finalTarget / cap, 1 / daysLeft) - 1;
                    day.dailyRate = rate;
                    day.profit = Math.round(cap * rate);
                    day.target = Math.round(cap + day.profit);
                    
                    if(day.actual !== "") {
                        const val = (day.pnlSign === '+' ? 1 : -1) * (Number(day.actual) || 0);
                        cap += val;
                    } else {
                        cap = day.target;
                    }
                    daysLeft--;
                });
                return newMonths;
            }, []);

            // Load/Save Firebase
            useEffect(() => {
                const userRef = db.ref('users/' + user.uid + '/journal');
                userRef.once('value', (snapshot) => {
                    const val = snapshot.val();
                    if(val) {
                        setData(val);
                        setInputCapital(val.initialCapital);
                        setInputTarget(val.finalTarget);
                        setInputTenure(val.tenure);
                    } else {
                        const months = generatePlan(DEFAULT_TENURE_DAYS);
                        const initData = { initialCapital: DEFAULT_INITIAL_CAPITAL, finalTarget: DEFAULT_FINAL_TARGET, tenure: DEFAULT_TENURE_DAYS, months };
                        initData.months = recalculate(initData);
                        setData(initData);
                        userRef.set(initData);
                    }
                });
            }, [user.uid]);

            // Auto-save
            useEffect(() => {
                if(data) {
                    const t = setTimeout(() => db.ref('users/' + user.uid + '/journal').set(data), 1000);
                    return () => clearTimeout(t);
                }
            }, [data, user.uid]);

            const handleConfigUpdate = () => {
                setData(prev => {
                    const newMonths = generatePlan(inputTenure);
                    const updated = { ...prev, initialCapital: inputCapital, finalTarget: inputTarget, tenure: inputTenure, months: newMonths };
                    updated.months = recalculate(updated);
                    return updated;
                });
            };

            const updateDay = (mIdx, dIdx, field, val) => {
                setData(prev => {
                    const copy = JSON.parse(JSON.stringify(prev));
                    copy.months[mIdx].days[dIdx][field] = val;
                    copy.months = recalculate(copy);
                    return copy;
                });
            };

            if (!data) return <div className="min-h-screen flex items-center justify-center bg-slate-900 text-blue-500 font-mono">LOADING TERMINAL...</div>;

            const currentMonth = data.months[activeMonthIndex];
            const displayDays = currentMonth.days.slice((currentPage-1)*DAYS_PER_PAGE, currentPage*DAYS_PER_PAGE);
            const progress = ((data.initialCapital / data.finalTarget) * 100).toFixed(1); // Simple calc

            return (
                <div className="flex min-h-screen bg-slate-50 dark:bg-slate-950">
                    <Sidebar active="journal" setActive={()=>{}} />
                    
                    <main className="flex-1 md:ml-20 p-4 md:p-8 overflow-x-hidden relative" ref={scrollRef}>
                        
                        {/* Header Bar */}
                        <header className="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                            <div>
                                <h1 className="text-2xl font-bold text-slate-900 dark:text-white tracking-tight flex items-center gap-2">
                                    <span className="w-2 h-8 bg-blue-600 rounded-sm"></span>
                                    Trading Journal
                                </h1>
                                <p className="text-slate-500 text-sm mt-1 font-medium">
                                    {getCurrentFormattedDate()} &bull; <span className="font-mono text-slate-700 dark:text-slate-300">{currentTime}</span>
                                </p>
                            </div>

                            <div className="flex items-center gap-3">
                                {/* Market Bubbles Link */}
                                <a href="https://cryptobubbles.net/" target="_blank" className="p-2 text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-lg transition-colors"><Icons.Chart /></a>
                                {/* Theme Toggle */}
                                <button onClick={toggleTheme} className="p-2 text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-lg transition-colors">
                                    {theme === 'dark' ? <Icons.Sun /> : <Icons.Moon />}
                                </button>
                                {/* Profile/Logout */}
                                <button onClick={onLogout} className="flex items-center gap-2 px-4 py-2 bg-slate-200 dark:bg-slate-800 hover:bg-slate-300 dark:hover:bg-slate-700 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-200 transition-colors">
                                    <Icons.User /> Logout
                                </button>
                            </div>
                        </header>

                        {/* Stats Dashboard */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                            <StatBox label="Starting Capital" value={formatCurrency(inputCapital)} subtext="Base Equity" />
                            <StatBox label="Profit Target" value={formatCurrency(inputTarget)} subtext="Objective" />
                            <StatBox label="Current Projected" value={formatCurrency(displayDays[0]?.capital || 0)} subtext="Real-time Equity" />
                            
                            {/* Goal Progress */}
                             <div className="bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm flex flex-col justify-center">
                                <div className="flex justify-between text-xs font-semibold uppercase text-slate-500 mb-2">
                                    <span>Goal Progress</span>
                                    <span>{progress}%</span>
                                </div>
                                <div className="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2.5">
                                    <div className="bg-blue-600 h-2.5 rounded-full transition-all duration-1000" style={{ width: `${Math.min(progress, 100)}%` }}></div>
                                </div>
                            </div>
                        </div>
                        
                        {/* Clocks & Config Row */}
                        <div className="flex flex-col lg:flex-row justify-between items-center mb-8 gap-8">
                            <div className="hidden lg:block"><ProClock title="Local" theme={theme} /></div>
                            
                            {/* Central Settings (Mini) */}
                            <div className="flex flex-wrap gap-2 justify-center bg-white dark:bg-slate-900 p-3 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                                <div className="flex flex-col px-2">
                                    <label className="text-[10px] text-slate-500 font-bold uppercase">Capital</label>
                                    <input type="number" value={inputCapital} onChange={e => setInputCapital(e.target.value)} className="bg-transparent w-24 font-mono text-sm focus:outline-none border-b border-transparent focus:border-blue-500" />
                                </div>
                                <div className="w-px bg-slate-200 dark:bg-slate-700 mx-2"></div>
                                <div className="flex flex-col px-2">
                                    <label className="text-[10px] text-slate-500 font-bold uppercase">Target</label>
                                    <input type="number" value={inputTarget} onChange={e => setInputTarget(e.target.value)} className="bg-transparent w-24 font-mono text-sm focus:outline-none border-b border-transparent focus:border-blue-500" />
                                </div>
                                <button onClick={handleConfigUpdate} className="ml-2 px-4 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold rounded uppercase tracking-wide">Update</button>
                            </div>

                            <div className="hidden lg:block"><ProClock title="UTC" timezoneOffset={0} theme={theme} /></div>
                        </div>

                        {/* Month Navigation */}
                        <div className="flex overflow-x-auto gap-2 mb-6 pb-2 scrollbar-thin">
                            {data.months.map((m, idx) => (
                                <button 
                                    key={m.id} 
                                    onClick={() => { setActiveMonthIndex(idx); setCurrentPage(1); }}
                                    className={`px-4 py-2 text-sm font-medium rounded-lg whitespace-nowrap transition-all ${activeMonthIndex === idx ? 'bg-slate-800 text-white dark:bg-white dark:text-slate-900 shadow-md' : 'bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700'}`}
                                >
                                    {m.monthName}
                                </button>
                            ))}
                        </div>

                        {/* Trade Blotter / Journal Entries */}
                        <div className="space-y-4">
                            {displayDays.map((day, i) => {
                                const originalIdx = (currentPage - 1) * DAYS_PER_PAGE + i;
                                const pnlVal = Number(day.actual) || 0;
                                const isProfit = day.pnlSign === '+' && pnlVal > 0;
                                const isLoss = day.pnlSign === '-' && pnlVal > 0;
                                
                                return (
                                    <div key={day.date} className="bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden group hover:border-blue-400 dark:hover:border-blue-600 transition-colors">
                                        {/* Ticket Header */}
                                        <div className="bg-slate-50 dark:bg-slate-800/50 px-4 py-3 border-b border-slate-100 dark:border-slate-700 flex flex-wrap justify-between items-center gap-4">
                                            <div className="flex items-center gap-4">
                                                <span className="text-xs font-bold text-slate-400 uppercase tracking-wider">Day {day.day}</span>
                                                <span className="text-sm font-semibold text-slate-700 dark:text-slate-200">{new Date(day.date).toLocaleDateString('en-US', {weekday:'short', month:'short', day:'numeric'})}</span>
                                                <span className="px-2 py-0.5 rounded text-xs font-mono bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-300">Target: {formatCurrency(day.target)}</span>
                                            </div>
                                            
                                            {/* P&L Input Area */}
                                            <div className="flex items-center bg-white dark:bg-slate-900 rounded-md border border-slate-200 dark:border-slate-600 p-1">
                                                <button 
                                                    onClick={() => updateDay(activeMonthIndex, originalIdx, 'pnlSign', '+')}
                                                    className={`w-8 h-7 rounded flex items-center justify-center text-sm font-bold transition-colors ${day.pnlSign === '+' ? 'bg-emerald-100 text-emerald-600 dark:bg-emerald-900 dark:text-emerald-400' : 'text-slate-400'}`}>+</button>
                                                <input 
                                                    type="number" 
                                                    placeholder="0" 
                                                    value={day.actual} 
                                                    onChange={(e) => updateDay(activeMonthIndex, originalIdx, 'actual', e.target.value)}
                                                    className="w-24 text-center bg-transparent font-mono text-sm font-bold focus:outline-none text-slate-900 dark:text-white" 
                                                />
                                                <button 
                                                    onClick={() => updateDay(activeMonthIndex, originalIdx, 'pnlSign', '-')}
                                                    className={`w-8 h-7 rounded flex items-center justify-center text-sm font-bold transition-colors ${day.pnlSign === '-' ? 'bg-rose-100 text-rose-600 dark:bg-rose-900 dark:text-rose-400' : 'text-slate-400'}`}>-</button>
                                            </div>
                                        </div>

                                        {/* Ticket Body */}
                                        <div className="p-4 grid grid-cols-1 md:grid-cols-12 gap-6">
                                            {/* Stats Column */}
                                            <div className="md:col-span-3 grid grid-cols-2 gap-4 content-start">
                                                <div>
                                                    <label className="text-[10px] uppercase text-slate-400 font-bold">Equity</label>
                                                    <div className="font-mono font-medium text-slate-700 dark:text-slate-300 text-sm">{formatCurrency(day.capital)}</div>
                                                </div>
                                                <div>
                                                    <label className="text-[10px] uppercase text-slate-400 font-bold">Req %</label>
                                                    <div className="font-mono font-medium text-blue-500 text-sm">{formatPercent(day.dailyRate)}</div>
                                                </div>
                                                <div>
                                                    <label className="text-[10px] uppercase text-slate-400 font-bold">Wins</label>
                                                    <input type="number" className="w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded px-2 py-1 text-xs font-mono" placeholder="0" value={day.winningTrades} onChange={e=>updateDay(activeMonthIndex, originalIdx, 'winningTrades', e.target.value)} />
                                                </div>
                                                <div>
                                                    <label className="text-[10px] uppercase text-slate-400 font-bold">Losses</label>
                                                    <input type="number" className="w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded px-2 py-1 text-xs font-mono" placeholder="0" value={day.losingTrades} onChange={e=>updateDay(activeMonthIndex, originalIdx, 'losingTrades', e.target.value)} />
                                                </div>
                                            </div>

                                            {/* Checklist Column */}
                                            <div className="md:col-span-4 border-l border-slate-100 dark:border-slate-700 pl-0 md:pl-6">
                                                <label className="text-[10px] uppercase text-slate-400 font-bold block mb-2">Execution Protocol</label>
                                                <div className="grid grid-cols-1 gap-1 max-h-32 overflow-y-auto scrollbar-thin pr-2">
                                                    {day.rules.map((rule, rIdx) => (
                                                        <label key={rIdx} className="flex items-center gap-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 p-1 rounded">
                                                            <input 
                                                                type="checkbox" 
                                                                checked={rule.checked} 
                                                                onChange={(e) => {
                                                                    const newRules = [...day.rules];
                                                                    newRules[rIdx].checked = e.target.checked;
                                                                    updateDay(activeMonthIndex, originalIdx, 'rules', newRules);
                                                                }}
                                                                className="w-3 h-3 text-blue-600 rounded border-slate-300 focus:ring-blue-500" 
                                                            />
                                                            <span className="text-xs text-slate-600 dark:text-slate-400 truncate">{rule.text}</span>
                                                        </label>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* Notes Column */}
                                            <div className="md:col-span-5 border-l border-slate-100 dark:border-slate-700 pl-0 md:pl-6">
                                                <label className="text-[10px] uppercase text-slate-400 font-bold block mb-2">Journal Notes</label>
                                                <textarea 
                                                    className="w-full h-full min-h-[80px] bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg p-3 text-xs text-slate-700 dark:text-slate-300 focus:ring-1 focus:ring-blue-500 outline-none resize-none font-mono leading-relaxed"
                                                    placeholder="// Trade setup, emotions, mistakes..."
                                                    value={day.logic}
                                                    onChange={(e) => updateDay(activeMonthIndex, originalIdx, 'logic', e.target.value)}
                                                ></textarea>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        {/* Pagination */}
                         <div className="flex justify-between items-center mt-8">
                            <button 
                                onClick={() => setCurrentPage(p => Math.max(1, p-1))} 
                                disabled={currentPage === 1}
                                className="px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm font-medium disabled:opacity-50 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors"
                            >
                                &larr; Previous
                            </button>
                            <span className="text-xs font-medium text-slate-400">Page {currentPage}</span>
                            <button 
                                onClick={() => setCurrentPage(p => p + 1)} // Simple logic, assumes more days exist
                                className="px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm font-medium hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors"
                            >
                                Next &rarr;
                            </button>
                        </div>
                    </main>

                    {/* Fixed Bottom Left Arrow */}
                    <div className="fixed bottom-8 left-8 z-40">
                         <button onClick={() => window.scrollTo({top:0, behavior:'smooth'})} className="p-3 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg transition-transform hover:-translate-y-1">
                             <Icons.ArrowUp />
                         </button>
                    </div>

                    {/* AI Button */}
                    <button 
                        onClick={() => setAnalystOpen(true)}
                        className="fixed bottom-8 right-8 z-50 px-5 py-3 bg-slate-900 dark:bg-blue-600 hover:bg-slate-800 dark:hover:bg-blue-700 text-white rounded-full shadow-xl font-medium text-sm flex items-center gap-2 transition-transform hover:scale-105 fab-shadow"
                    >
                        <Icons.AI /> Ask Analyst
                    </button>

                    {/* Analyst Panel */}
                    {isAnalystOpen && <AnalystPanel onClose={() => setAnalystOpen(false)} tradingData={data.months[activeMonthIndex].days} />}
                </div>
            );
        }

        // --- AUTH SCREENS ---
        const AuthScreen = ({ onLogin, onRegister }) => {
            const [isRegister, setIsRegister] = useState(false);
            const [email, setEmail] = useState("");
            const [password, setPassword] = useState("");

            const handleSubmit = (e) => {
                e.preventDefault();
                if(isRegister) onRegister(email, password);
                else onLogin(email, password);
            };

            return (
                <div className="min-h-screen bg-slate-900 flex items-center justify-center p-4">
                    <div className="w-full max-w-md bg-slate-800 rounded-2xl border border-slate-700 shadow-2xl p-8">
                        <div className="flex justify-center mb-6">
                            <div className="w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center text-white text-2xl font-bold shadow-lg">DT</div>
                        </div>
                        <h2 className="text-center text-2xl font-bold text-white mb-2">Welcome Back</h2>
                        <p className="text-center text-slate-400 text-sm mb-8">Sign in to your professional trading journal</p>
                        
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-xs font-bold text-slate-400 uppercase mb-1">Email</label>
                                <input type="email" required className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-blue-600 outline-none transition-all" value={email} onChange={e=>setEmail(e.target.value)} />
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-slate-400 uppercase mb-1">Password</label>
                                <input type="password" required className="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-blue-600 outline-none transition-all" value={password} onChange={e=>setPassword(e.target.value)} />
                            </div>
                            <button type="submit" className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-lg transition-transform active:scale-95">
                                {isRegister ? 'Create Account' : 'Access Terminal'}
                            </button>
                        </form>
                        
                        <div className="mt-6 text-center">
                            <button onClick={() => setIsRegister(!isRegister)} className="text-sm text-slate-400 hover:text-white transition-colors">
                                {isRegister ? "Already have an account? Log In" : "Need an account? Register"}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const AuthWrapper = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                return auth.onAuthStateChanged(u => { setUser(u); setLoading(false); });
            }, []);

            const login = (e, p) => auth.signInWithEmailAndPassword(e, p).catch(err => alert(err.message));
            const reg = (e, p) => auth.createUserWithEmailAndPassword(e, p).catch(err => alert(err.message));

            if(loading) return <div className="min-h-screen bg-slate-900 flex items-center justify-center text-blue-500">Initializing Secure Connection...</div>;
            if(!user) return <AuthScreen onLogin={login} onRegister={reg} />;
            return <App user={user} onLogout={() => auth.signOut()} />;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AuthWrapper />);
    </script>
</body>
</html>
